<!DOCTYPE html>
<html class="loading" lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BRidge Admin ‚Äî Billing & Plans</title>

  <!-- Bootstrap + app css -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/static/app.css?v=20251111" nonce="{{NONCE}}">
  <script src="/static/js/locale.js?v=20251127" defer nonce="{{NONCE}}"></script>
  <script src="/static/js/admin-billing.js?v=20251127" defer nonce="{{NONCE}}"></script>

</head>
<body>

  <!-- Locale strip -->
  <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
    <label class="form-label m-0" for="lang-select" data-i18n="language">Language</label>
    <select id="lang-select" class="form-select form-select-sm w-auto">
      <option value="en">English</option><option value="es">Espa√±ol</option><option value="zh">‰∏≠Êñá</option>
    </select>
    <label class="form-label m-0 ms-2" for="tz-select" data-i18n="timezone">Timezone</label>
    <input id="tz-select" class="form-control form-control-sm w-220" list="tz-list" placeholder="America/Phoenix" data-i18n-ph="timezone"/>
    <datalist id="tz-list">
      <option value="America/Phoenix"></option><option value="America/New_York"></option>
      <option value="America/Chicago"></option><option value="America/Los_Angeles"></option>
      <option value="UTC"></option><option value="Europe/London"></option><option value="Asia/Shanghai"></option>
    </datalist>
    <button id="save-locale" class="btn btn-outline-secondary btn-sm ms-1">
      <span data-i18n="save">Save</span>
    </button>
    <small class="text-muted ms-auto" id="local-time"></small>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast-bridge" role="status" aria-live="polite" aria-atomic="true" tabindex="-1"></div>

  <nav class="nav nav-pills small">
    <a class="nav-link" href="/admin">Dashboard</a>
    <a class="nav-link active" href="/admin-billing.html">Billing</a>
    <a class="nav-link" href="/admin-compliance.html">Compliance</a>
    <a class="nav-link" href="/admin-tenants.html">Tenants</a>
    <a class="nav-link" href="/indices.html">Indices</a>
    <a class="nav-link" href="/trader.html">Trader</a>
    </nav>

  <div class="container-fluid">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="d-flex align-items-center gap-2">
        <h2 class="mb-0">üí≥ BRidge Admin ‚Äî Billing & Plans</h2>
        <span class="badge bg-light text-muted">Stripe-backed ¬∑ Usage-based</span>
      </div>
      <span class="health-badge" data-health-badge>‚óè Checking‚Ä¶</span>
    </div>

    <div class="row g-3">
      <!-- LEFT COLUMN: Plans + Members Summary -->
      <div class="col-lg-5">
        <!-- Plan Catalog -->
        <div class="card mb-3">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span><strong>Plan Catalog</strong></span>
            <button id="reloadPlans" class="btn btn-sm btn-outline-secondary">Refresh</button>
          </div>
          <div class="card-body p-2">
            <div class="table-responsive">
              <table class="table table-sm table-striped align-middle mb-0" id="planTbl">
                <thead class="table-light">
                  <tr>
                    <th>Code</th><th>Name</th><th>Price (USD)</th><th>Active</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="4" class="text-muted text-center py-2">Loading‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
            <div class="small text-muted mt-1">
              Backed by <code>billing_plans</code> and <code>billing_plan_limits</code>.
            </div>
          </div>
        </div>

        <!-- Member Usage & Guaranty Summary -->
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span><strong>Members ‚Äî Usage & Guaranty</strong></span>
            <span class="small text-muted">Current billing cycle</span>
          </div>
          <div class="card-body p-2">
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle mb-0" id="memberTbl">
                <thead class="table-light">
                  <tr>
                    <th>Member</th>
                    <th>Plan</th>
                    <th>BOLs</th>
                    <th>Contracts</th>
                    <th>Guaranty ($)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="5" class="text-muted text-center py-2">Loading‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
            <div class="small text-muted mt-1">
              Usage from <code>/analytics/usage_by_member_current_cycle</code>, guaranty from <code>guaranty_fund</code>.
              Click a row to load member details.
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Member Detail -->
      <div class="col-lg-7">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div>
              <strong>Member Detail</strong>
              <span id="detailMember" class="ms-2 text-muted"></span>
            </div>
            <span id="detailStatus" class="small text-muted"></span>
          </div>
          <div class="card-body">
            <!-- Plan & Guaranty Summary -->
            <div class="row g-3 mb-2">
              <div class="col-md-4">
                <span class="form-label d-block">Plan</span>
                <div id="detailPlan" class="form-control-plaintext small text-muted">‚Äî</div>
              </div>
              <div class="col-md-4">
                <span class="form-label d-block">Guaranty Fund</span>
                <div id="detailGuaranty" class="form-control-plaintext small text-muted">‚Äî</div>
              </div>
              <div class="col-md-4">
                <span class="form-label d-block">Defaults</span>
                <div id="detailDefaults" class="form-control-plaintext small text-muted">‚Äî</div>
              </div>
            </div>

            <hr class="my-3">

            <!-- Billing Preferences -->
            <h6 class="mb-2">Billing Preferences</h6>
            <form id="prefsForm" class="row g-2 mb-3">
              <div class="col-md-2">
                <label class="form-label" for="prefDay">Billing Day</label>
                <input id="prefDay" type="number" min="1" max="28" class="form-control form-control-sm" placeholder="1">
              </div>
              <div class="col-md-3">
                <label class="form-label" for="prefTz">Timezone</label>
                <input id="prefTz" class="form-control form-control-sm" placeholder="America/Phoenix">
              </div>
              <div class="col-md-2">
                <div class="form-check mt-4">
                  <input class="form-check-input" type="checkbox" id="prefAutopay">
                  <label class="form-check-label small" for="prefAutopay">Autopay</label>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-check mt-4">
                  <input class="form-check-input" type="checkbox" id="prefAutoCharge">
                  <label class="form-check-label small" for="prefAutoCharge">Auto-charge</label>
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label" for="prefCc">Invoice CC Emails</label>
                <input id="prefCc" class="form-control form-control-sm" placeholder="comma-separated">
              </div>
              <div class="col-12 d-flex justify-content-end gap-2">
                <button id="prefsSave" type="button" class="btn btn-sm btn-primary">Save Preferences</button>
              </div>
            </form>

            <hr class="my-3">

            <!-- Invoice list + detail -->
            <div class="row g-3">
              <div class="col-md-6">
                <h6 class="mb-2">Invoices</h6>
                <div class="table-responsive">
                  <table class="table table-sm table-hover align-middle mb-0" id="invoiceTbl">
                    <thead class="table-light">
                      <tr>
                        <th>Period</th>
                        <th>Total</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td colspan="3" class="text-muted text-center py-2">No member selected.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="col-md-6">
                <h6 class="mb-2">Invoice Lines</h6>
                <div class="table-responsive">
                  <table class="table table-sm table-striped align-middle mb-0" id="invoiceLinesTbl">
                    <thead class="table-light">
                      <tr>
                        <th>Event</th>
                        <th>Amount</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td colspan="2" class="text-muted text-center py-2">Select an invoice.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="small text-muted mt-3">
              This panel reads from <code>member_plans</code>, <code>billing_preferences</code>, <code>billing_invoices</code>,
              <code>billing_line_items</code>, <code>guaranty_fund</code>, and <code>default_events</code>.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="legal-footer">
    <hr class="mb-3">
    <nav class="small d-flex flex-wrap gap-2 justify-content-center" aria-label="Legal navigation">
      <a href="/legal/terms.html" class="link-secondary" rel="noopener noreferrer">Terms</a><span>¬∑</span>
      <a href="/legal/privacy.html" class="link-secondary" rel="noopener noreferrer">Privacy</a><span>¬∑</span>
      <a href="/legal/eula.html" class="link-secondary" rel="noopener noreferrer">EULA</a><span>¬∑</span>
      <a href="/legal/aup.html" class="link-secondary" rel="noopener noreferrer">AUP</a><span>¬∑</span>
      <a href="/legal/cookies.html" class="link-secondary" rel="noopener noreferrer">Cookies</a><span>¬∑</span>
      <a href="/legal/subprocessors.html" class="link-secondary" rel="noopener noreferrer">Subprocessors</a><span>¬∑</span>
      <a href="/legal/dpa.html" class="link-secondary" rel="noopener noreferrer">DPA</a><span>¬∑</span>
      <a href="/legal/sla.html" class="link-secondary" rel="noopener noreferrer">SLA</a><span>¬∑</span>
      <a href="/legal/security.html" class="link-secondary" rel="noopener noreferrer">Security</a><span>¬∑</span>
      <a href="/legal/fees.html" class="link-secondary" rel="noopener noreferrer">Fee Schedule</a>
    </nav>

    <div class="mt-3"><strong>BRidge Platform</strong> ‚Äì Powered by ScrapFutures.com</div>
    <div>For acquisition inquiries or product demos:</div>
    <div><a href="mailto:info@atlasipholdingsllc.com">info@atlasipholdingsllc.com</a></div>
    <div class="mt-2">&copy; 2025 BRidge Technologies. All rights reserved.</div>
  </footer>
</body>
</html>
