<!DOCTYPE html>
<html class="loading" lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BRidge Admin ‚Äî Compliance & Surveillance</title>

  <!-- Bootstrap + app css -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/static/app.css?v=20251111" />  

  <script src="/static/js/locale.js?v=20251127" defer nonce="{{NONCE}}"></script>
  <script src="/static/js/admin-compliance.js?v=20251127" defer nonce="{{NONCE}}"></script>


</head>
<body>

  <!-- Locale strip -->
  <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
    <label class="form-label m-0" for="lang-select" data-i18n="language">Language</label>
    <select id="lang-select" class="form-select form-select-sm w-auto">
      <option value="en">English</option><option value="es">Espa√±ol</option><option value="zh">‰∏≠Êñá</option>
    </select>
    <label class="form-label m-0 ms-2" for="tz-select" data-i18n="timezone">Timezone</label>
    <input id="tz-select" class="form-control form-control-sm w-220" list="tz-list" placeholder="America/Phoenix" data-i18n-ph="timezone"/>
    <datalist id="tz-list">
      <option value="America/Phoenix"></option><option value="America/New_York"></option>
      <option value="America/Chicago"></option><option value="America/Los_Angeles"></option>
      <option value="UTC"></option><option value="Europe/London"></option><option value="Asia/Shanghai"></option>
    </datalist>
    <button id="save-locale" class="btn btn-outline-secondary btn-sm ms-1">
      <span data-i18n="save">Save</span>
    </button>
    <small class="text-muted ms-auto" id="local-time"></small>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast-bridge" role="status" aria-live="polite" aria-atomic="true" tabindex="-1"></div>
  
  <nav class="nav nav-pills small">
    <a class="nav-link" href="/admin">Dashboard</a>
    <a class="nav-link" href="/admin-billing.html">Billing</a>
    <a class="nav-link active" href="/admin-compliance.html">Compliance</a>
    <a class="nav-link" href="/admin-tenants.html">Tenants</a>
    <a class="nav-link" href="/indices.html">Indices</a>
    <a class="nav-link" href="/trader.html">Trader</a>
  </nav>

  <div class="container-fluid">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="d-flex align-items-center gap-2">
        <h2 class="mb-0">üõ°Ô∏è BRidge Admin ‚Äî Compliance & Surveillance</h2>
        <span class="badge bg-light text-muted">KYC ¬∑ AML ¬∑ BSA ¬∑ Surveillance</span>
      </div>
      <span class="health-badge" data-health-badge>‚óè Checking‚Ä¶</span>
    </div>

    <div class="row g-3">
      <!-- LEFT COLUMN: Compliance Members -->
      <div class="col-lg-5">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span><strong>Compliance Members</strong></span>
            <div class="d-flex align-items-center gap-2">
              <input id="filterUser" class="form-control form-control-sm" placeholder="Filter username" style="max-width:180px">
              <button id="reloadMembers" class="btn btn-sm btn-outline-secondary">Refresh</button>
            </div>
          </div>
          <div class="card-body p-2">
            <div class="table-responsive" style="max-height:420px; overflow:auto;">
              <table class="table table-sm table-hover align-middle mb-0" id="compTbl">
                <thead class="table-light">
                  <tr>
                    <th>User</th>
                    <th>KYC</th>
                    <th>AML</th>
                    <th>BSA Risk</th>
                    <th>Sanctions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="5" class="text-muted text-center py-2">Loading‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
            <div class="small text-muted mt-2">
              Backed by <code>compliance_members</code>. Click a row to edit flags.
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Alerts + Cases -->
      <div class="col-lg-7">
        <div class="card mb-3">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span><strong>Surveillance Alerts</strong></span>
            <div class="d-flex align-items-center gap-2">
              <label class="small mb-0" for="alertSeverityFilter">Severity</label>
              <select id="alertSeverityFilter" class="form-select form-select-sm" style="max-width:140px">
                <option value="">(all)</option>
                <option value="info">info</option>
                <option value="warn">warn</option>
                <option value="high">high</option>
              </select>
              <button id="reloadAlerts" class="btn btn-sm btn-outline-secondary">Refresh</button>
            </div>
          </div>
          <div class="card-body p-2">
            <div class="table-responsive" style="max-height:220px; overflow:auto;">
              <table class="table table-sm table-striped align-middle mb-0" id="alertTbl">
                <thead class="table-light">
                  <tr>
                    <th>Rule</th>
                    <th>Subject</th>
                    <th>Severity</th>
                    <th>When</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td colspan="4" class="text-muted text-center py-2">Loading‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
            <div class="small text-muted mt-2">
              Data from <code>surveil_alerts</code>. Use alerts to open or update cases below.
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <span><strong>Cases</strong></span>
            <div class="d-flex align-items-center gap-2">
              <label class="small mb-0" for="caseStatusFilter">Status</label>
              <select id="caseStatusFilter" class="form-select form-select-sm" style="max-width:140px">
                <option value="">(all)</option>
                <option value="open">open</option>
                <option value="under_review">under_review</option>
                <option value="closed">closed</option>
              </select>
              <button id="reloadCases" class="btn btn-sm btn-outline-secondary">Refresh</button>
            </div>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="table-responsive" style="max-height:260px; overflow:auto;">
                  <table class="table table-sm table-hover align-middle mb-0" id="caseTbl">
                    <thead class="table-light">
                      <tr>
                        <th>ID</th>
                        <th>Rule</th>
                        <th>Subject</th>
                        <th>Status</th>
                        <th>Opened</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr><td colspan="5" class="text-muted text-center py-2">Loading‚Ä¶</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="col-md-6">
                <h6 class="mb-2">Case Detail</h6>
                <div class="mb-2 small text-muted" id="caseDetailHeader">Select a case.</div>
                <form id="caseForm" class="mb-2">
                  <div class="mb-2">
                    <label class="form-label" for="caseStatus">Status</label>
                    <select id="caseStatus" class="form-select form-select-sm">
                      <option value="open">open</option>
                      <option value="under_review">under_review</option>
                      <option value="closed">closed</option>
                    </select>
                  </div>
                  <div class="mb-2">
                    <label class="form-label" for="caseNotes">Notes</label>
                    <textarea id="caseNotes" class="form-control form-control-sm" rows="4" placeholder="Add review notes, rationale, escalation steps..."></textarea>
                  </div>
                  <div class="d-flex justify-content-end gap-2">
                    <button id="caseSave" type="button" class="btn btn-sm btn-primary">Save Case</button>
                  </div>
                </form>
                <div class="small text-muted">
                  Cases live in <code>surveil_cases</code>. Updating status + notes writes back for audit.
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>

  <script
    nonce="{{NONCE}}"
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"
    defer
  ></script>

  <footer class="legal-footer">
    <hr class="mb-3">
    <nav class="small d-flex flex-wrap gap-2 justify-content-center" aria-label="Legal navigation">
      <a href="/legal/terms.html" class="link-secondary" rel="noopener noreferrer">Terms</a><span>¬∑</span>
      <a href="/legal/privacy.html" class="link-secondary" rel="noopener noreferrer">Privacy</a><span>¬∑</span>
      <a href="/legal/eula.html" class="link-secondary" rel="noopener noreferrer">EULA</a><span>¬∑</span>
      <a href="/legal/aup.html" class="link-secondary" rel="noopener noreferrer">AUP</a><span>¬∑</span>
      <a href="/legal/cookies.html" class="link-secondary" rel="noopener noreferrer">Cookies</a><span>¬∑</span>
      <a href="/legal/subprocessors.html" class="link-secondary" rel="noopener noreferrer">Subprocessors</a><span>¬∑</span>
      <a href="/legal/dpa.html" class="link-secondary" rel="noopener noreferrer">DPA</a><span>¬∑</span>
      <a href="/legal/sla.html" class="link-secondary" rel="noopener noreferrer">SLA</a><span>¬∑</span>
      <a href="/legal/security.html" class="link-secondary" rel="noopener noreferrer">Security</a><span>¬∑</span>
      <a href="/legal/fees.html" class="link-secondary" rel="noopener noreferrer">Fee Schedule</a>
    </nav>

    <div class="mt-3"><strong>BRidge Platform</strong> ‚Äì Powered by ScrapFutures.com</div>
    <div>For acquisition inquiries or product demos:</div>
    <div><a href="mailto:info@atlasipholdingsllc.com">info@atlasipholdingsllc.com</a></div>
    <div class="mt-2">&copy; 2025 BRidge Technologies. All rights reserved.</div>
  </footer>
</body>
</html>
