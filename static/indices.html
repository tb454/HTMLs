<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>BRidge Indices Dashboard</title>
  <meta name="theme-color" content="#0f62fe">
  <meta name="description" content="Auditable daily scrap indices with forecast overlay.">
  <link rel="icon" href="/static/favicon.ico">

  <!-- Fonts (allowed by your CSP) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/app.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4" defer nonce="{{NONCE}}"></script>
  <script src="/static/js/locale.js" defer nonce="{{NONCE}}"></script>
  <script src="/static/js/i18n.js" defer nonce="{{NONCE}}"></script>
</head>
<body>

<div class="topbar">
  <div class="brand">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M4 12h16M4 6h10M4 18h10" stroke="#0f62fe" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <h1>BRidge Scrap Indices™</h1>
  </div>
  <div class="muted">USD/lb • daily closes & forecast overlay · <span class="health-badge" data-health-badge>● Checking…</span></div>
</div>

<div class="d-flex align-items-center gap-2 mb-2 px-2 flex-wrap">
  <label class="form-label m-0" for="lang-select" data-i18n="language">Language</label>
  <select id="lang-select" class="form-select form-select-sm w-auto">
    <option value="en">English</option><option value="es">Español</option><option value="zh">中文</option>
  </select>
  <label class="form-label m-0 ms-2" for="tz-select" data-i18n="timezone">Timezone</label>
  <input id="tz-select" class="form-control form-control-sm w-220" list="tz-list" placeholder="America/Phoenix" data-i18n-ph="timezone"/>
  <datalist id="tz-list">
    <option value="America/Phoenix"></option><option value="America/New_York"></option>
    <option value="America/Chicago"></option><option value="America/Los_Angeles"></option>
    <option value="UTC"></option><option value="Europe/London"></option><option value="Asia/Shanghai"></option>
  </datalist>
  <button id="save-locale" class="btn btn-outline-secondary btn-sm ms-1"><span data-i18n="save">Save</span></button>
  <small class="text-muted ms-auto" id="local-time"></small>
</div>

<div class="grid">
  <div class="card">
    <div class="toolbar">
      <button class="btn" id="refreshAll">Refresh</button>      
      <span class="flex-grow-1"></span>
      <input id="filterInput" class="input" placeholder="Filter tickers… (e.g., CU_*, HMS)" aria-label="Filter tickers"/>
    </div>
    <table id="universeTbl" aria-label="Index universe">
      <thead class="sticky">
        <tr>
          <th>Ticker</th><th>Last</th><th>Δ</th><th>Updated</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card">
    <h3 id="detailTitle" class="mt-0">Details</h3>
    <div class="muted" id="detailNote"></div>
    <div class="mt-8 flex gap-8 flex-wrap">
      <button class="btn" data-days="30" aria-pressed="true">30d</button>
      <button class="btn" data-days="90">90d</button>
      <button class="btn" id="toggleForecast" aria-pressed="false">Toggle Forecast Overlay</button>
    </div>
    <canvas id="chart"></canvas>
    <canvas id="forecastChart" class="mt-10 hidden"></canvas>
    <div class="mt-10 flex gap-8 flex-wrap">
      <button class="btn" id="exportHistory">Export History CSV</button>
      <button class="btn" id="exportForecast">Export Forecast CSV</button>
    </div>
    <div class="mt-1 d-flex gap-2 flex-wrap">
      <button class="btn" id="dlDailyJson" aria-label="Download daily indices as JSON">Daily JSON (public)</button>
      <button class="btn" id="dlDailyCsv"  aria-label="Download daily indices as CSV">Daily CSV (public)</button>
    </div>
    <div id="provenance" class="muted mt-8 fs-12">
      <span id="asofLine">As of: —</span> ·
      <span id="methodLine">Method: —</span> ·
      <span id="hashLine">Hash: —</span>
    </div>
  </div>
</div>

<!-- Toast node (needed by toast()) -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Shared helpers: defines window.endpoint, api(), toast() -->
<script src="/static/js/app.js?v=20251111" defer nonce="{{NONCE}}"></script>
<script src="/static/js/indices.js" defer nonce="{{NONCE}}"></script>

<footer class="muted mt-20 fs-12 text-center">
  BR-Index values are produced by Atlas IP Holdings using the published methodology.
  Provisional values may be revised pursuant to the corrections policy. No investment advice.
</footer>
</body>
</html>
