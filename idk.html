<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BRidge Dashboard with Futures Pricing</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <style>
    /* Base Styling */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: auto;
    }
    /* Header */
    header.header {
      background: linear-gradient(90deg, #2c3e50, #34495e);
      color: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    header.header h1 {
      font-size: 28px;
      margin: 0;
    }
    .user-info {
      font-size: 14px;
    }
    .user-info button {
      margin: 0 10px;
      padding: 6px 14px;
      border: none;
      background-color: #e74c3c;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .user-info button:hover {
      background-color: #c0392b;
    }
    /* Section Styling */
    section.section {
      background-color: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .section-title {
      font-weight: 700;
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 3px solid #3498db;
      padding-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #3498db;
    }
    /* Overview Cards and Tables (existing styling unchanged) */
    /* ... (other styles remain unchanged) ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- Existing Dashboard Sections (Header, Overview Cards, Finished Goods Inventory, etc.) -->
    
    <!-- FUTURES CONTRACT PRICING SECTION -->
    <section class="section">
      <div class="section-title">Futures Contract Pricing</div>
      <div class="mb-3">
        <label for="material-category" class="form-label">Material Category:</label>
        <select id="material-category" class="form-select" onchange="populateProducts()">
          <option value="">Select Category</option>
          <option value="copper">Copper</option>
          <option value="aluminum">Aluminum</option>
          <option value="brass">Brass</option>
          <option value="lead">Lead</option>
          <option value="stainless">Stainless Steel</option>
          <option value="eScrap">E-Scrap</option>
          <option value="insulatedWire">Insulated Wire</option>
          <option value="miscProduct">Misc Product</option>
          <option value="radiatorProduct">Radiator Product</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="material-product" class="form-label">Product:</label>
        <select id="material-product" class="form-select"></select>
      </div>
      <div class="mb-3">
        <button class="action-btn" onclick="calculateFuturesPrice()">Calculate Futures Price</button>
      </div>
      <div id="futures-price-result" class="mt-3"></div>
    </section>
    
    <!-- (The rest of your existing dashboard sections remain unchanged) -->
    
  </div>
  
  <!-- KPI Detail Modal, Architecture Overview Modal, etc. (unchanged) -->
  
  <!-- Bootstrap Bundle JS and Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Existing Dashboard Scripts (for market data, charts, etc.) -->
  <script>
    // Global variable for marketSnapshotPrices (populated by backend)
    let marketSnapshotPrices = {
      "Copper": 9500,
      "Busheling Steel": 700,
      "Brass": 7500,
      "Aluminum": 2200,
      "Electric Motors": 900,
      "Insulated Copper Wire": 3600,
      "Lead": 1500,
      "HMS Steel #2": 500,
      "Cu Radiator (50Cu/50Brass)": 5600,
      "Carbide": 20000,
      "Stainless Steel": 1600
    };
    
    // Fetch market data from backend every 15 seconds
    function fetchMarketData() {
      fetch('http://localhost:5000/api/market-data')
        .then(response => response.json())
        .then(data => {
          for (const commodity in data.marketPrices) {
            const price = data.marketPrices[commodity];
            marketSnapshotPrices[commodity] = price;
            const elementId = "price-" + commodity.replace(/[^a-zA-Z0-9]/g, '');
            const element = document.getElementById(elementId);
            if (element && price !== null) {
              element.textContent = `${commodity}: $${price.toFixed(2)}`;
            }
          }
        })
        .catch(err => console.error('Error fetching market data:', err));
    }
    document.addEventListener('DOMContentLoaded', fetchMarketData);
    setInterval(fetchMarketData, 15000);
    
    // (Other functions for active contracts, finished goods, etc. remain unchanged)
  </script>
  
  <!-- Futures Pricing Formulas and Material Lists -->
  <script>
    // Base market prices for pricing formulas
    const COMEX_Cu = 4.19;
    const LME_Al = 1.25;
    const LME_Lead = 2034 / 2000;
    const LME_Zinc = 2879 / 2000;
    const LME_Ni = 15675 / 2000;
    
    // Pricing Formulas
    function copperPrice(grade) {
      switch(grade) {
        case 'Barley': return COMEX_Cu * 0.94;
        case '#1': return COMEX_Cu * 0.91;
        case '#2': return COMEX_Cu * 0.85;
        case '#3': return COMEX_Cu * 0.83;
        default: return null;
      }
    }
    function aluminumPrice(product) {
      switch(product) {
        case 'AL6061_NewBareExtrusion': return LME_Al * 0.84;
        case 'AL6061_ClipPlatePipe': return LME_Al * 0.78;
        case 'AL6063_Secondary': return LME_Al * 0.78;
        case 'AL6063_OldExtrusion': return LME_Al * 0.95;
        case 'AL6063_Extrusion10/10': return LME_Al * 0.85;
        case 'AL_PAS_Baled': return LME_Al * 0.82;
        case 'AL_Cast_Clean': return LME_Al * 0.72;
        case 'AL_RADS_CleanBaled': return LME_Al * 0.67;
        case 'AL_RADS_DirtyBaled': return LME_Al * 0.46;
        case 'AL_Sheet_CleanBaled': return LME_Al * 0.75;
        case 'AL_WheelAuto_Clean': return LME_Al * 0.93;
        case 'AL_WheelChrome_Clean': return LME_Al * 0.80;
        case 'TruckWheel_Clean': return LME_Al * 0.72;
        case 'AL_Wire_BareCATV': return LME_Al * 0.43;
        case 'AL_Wire_NeopreneACSR': return LME_Al * 0.54;
        case 'AL_Wire_ECPrepared': return LME_Al * 1.03;
        case 'AL_MLC_Prepared': return LME_Al * 0.84;
        default: return null;
      }
    }
    function brassPrice(product) {
      switch(product) {
        case 'Brass_Hard': return COMEX_Cu * 0.81;
        case 'Brass_Red_Ebony': return COMEX_Cu * 0.77;
        case 'Brass_Red_Semi': return COMEX_Cu * 0.72;
        case 'Brass_Shaving_AlBronze': return COMEX_Cu * 0.57;
        case 'Brass_Shaving_BrassRed': return COMEX_Cu * 0.61;
        case 'Brass_Shell': return COMEX_Cu * 0.60;
        case 'Brass_Special': return COMEX_Cu * 0.64;
        case 'Brass_YellowRegular': return COMEX_Cu * 0.61;
        default: return null;
      }
    }
    function leadPrice(product) {
      switch(product) {
        case 'Lead_Clean': return LME_Lead * 0.718;
        case 'Lead_Range': return LME_Lead * 0.728;
        default: return null;
      }
    }
    function stainlessPrice(product) {
      switch(product) {
        case 'SS304': return LME_Ni * 0.0638;
        case 'SS316': return LME_Ni * 0.1174;
        default: return null;
      }
    }
    function eScrapPrice(goldContent, goldSpot, silverContent, silverSpot, copperContent, processingFee) {
      return (goldContent * goldSpot) + (silverContent * silverSpot) + (copperContent * COMEX_Cu) - processingFee;
    }
    function insulatedWirePrice(product) {
      switch(product) {
        case 'ICW_LowGrade_ChristmasLights': return LME_Al * 0.528;
        case 'ICW_LowGrade_ComputerWire25': return LME_Al * 0.448;
        case 'ICW_LowGrade_CuCATV': return LME_Al * 1.008;
        case 'ICW_LowGrade_ExtCords35Up': return LME_Al * 0.92;
        case 'ICW_LowGrade_MixedWire40Up': return LME_Al * 1.08;
        case 'ICW1_Heliax57_OpenEyeBaled': return LME_Al * 1.536;
        case 'ICW1_MCM85HG': return LME_Al * 2.536;
        case 'ICW1_Romex65_NoWeatherProof': return LME_Al * 1.904;
        case 'ICW1_THHN80': return LME_Al * 2.36;
        case 'ICW2_50Cat5TelWire': return LME_Al * 1.384;
        case 'ICW2_HarnessWireNoFuseBoxes': return LME_Al * 1.408;
        case 'ICW2_BX_Cable_AL': return LME_Al * 1.648;
        case 'ICW2_BX_Cable_FE24': return LME_Al * 0.6;
        default: return null;
      }
    }
    function miscProductPrice(product) {
      switch(product) {
        case 'Ballast_Electronic': return LME_Al * 0.12;
        case 'Ballast_Regular': return LME_Al * 0.216;
        case 'BatteryAuto_PbAcid': return LME_Al * 0.216;
        case 'BatterySteelCase_Industrial': return LME_Al * 0.192;
        case 'Compressor_SealedUnitNoCastIron': return LME_Al * 0.264;
        case 'EMotorLowGrade_CeilingFanMotors': return LME_Al * 0.144;
        case 'EMotorMix_NoPumpsPowerToolsFans': return LME_Al * 0.344;
        case 'EMotorLarge_LessThan1000lbs': return LME_Al * 0.312;
        case 'Transformer_AluLargeOnly': return LME_Al * 0.176;
        case 'TransformerCu_AlCu': return LME_Al * 0.28;
        case 'TransformerCu_SmallPalmSize': return LME_Al * 0.56;
        case 'TransformerCu_MediumOver200lbs': return LME_Al * 0.592;
        case 'TransformerCu_Large': return LME_Al * 0.624;
        case 'Zinc_DieCast': return LME_Zinc * 0.5903;
        default: return null;
      }
    }
    function radiatorProductPrice(product) {
      switch(product) {
        case 'ACReefer_CleanTalkBaled': return LME_Al * 1.608;
        case 'ACReefer_CleanUnbaled': return LME_Al * 1.592;
        case 'ACReefer_DirtyTalkBaled': return LME_Al * 1.496;
        case 'ACReefer_DirtyUnbaled': return LME_Al * 1.48;
        case 'Radiator_CleanCar': return LME_Al * 1.984;
        case 'CuBkg_ACReeferEnd': return LME_Al * 1.008;
        default: return null;
      }
    }
    
    // Updated Material Arrays
    const copperMaterials = ["Barley", "#1", "#2", "#3"];
    const aluminumMaterials = [
      "AL6061_NewBareExtrusion",
      "AL6061_ClipPlatePipe",
      "AL6063_Secondary",
      "AL6063_OldExtrusion",
      "AL6063_Extrusion10/10",
      "AL_PAS_Baled",
      "AL_Cast_Clean",
      "AL_RADS_CleanBaled",
      "AL_RADS_DirtyBaled",
      "AL_Sheet_CleanBaled",
      "AL_WheelAuto_Clean",
      "AL_WheelChrome_Clean",
      "TruckWheel_Clean",
      "AL_Wire_BareCATV",
      "AL_Wire_NeopreneACSR",
      "AL_Wire_ECPrepared",
      "AL_MLC_Prepared"
    ];
    const brassMaterials = [
      "Brass_Hard",
      "Brass_Red_Ebony",
      "Brass_Red_Semi",
      "Brass_Shaving_AlBronze",
      "Brass_Shaving_BrassRed",
      "Brass_Shell",
      "Brass_Special",
      "Brass_YellowRegular"
    ];
    const leadMaterials = ["Lead_Clean", "Lead_Range"];
    const stainlessMaterials = ["SS304", "SS316"];
    const eScrapMaterials = ["E_Scrap_Board"];
    const insulatedWireMaterials = [
      "ICW_LowGrade_ChristmasLights",
      "ICW_LowGrade_ComputerWire25",
      "ICW_LowGrade_CuCATV",
      "ICW_LowGrade_ExtCords35Up",
      "ICW_LowGrade_MixedWire40Up",
      "ICW1_Heliax57_OpenEyeBaled",
      "ICW1_MCM85HG",
      "ICW1_Romex65_NoWeatherProof",
      "ICW1_THHN80",
      "ICW2_50Cat5TelWire",
      "ICW2_HarnessWireNoFuseBoxes",
      "ICW2_BX_Cable_AL",
      "ICW2_BX_Cable_FE24"
    ];
    const miscProductMaterials = [
      "Ballast_Electronic",
      "Ballast_Regular",
      "BatteryAuto_PbAcid",
      "BatterySteelCase_Industrial",
      "Compressor_SealedUnitNoCastIron",
      "EMotorLowGrade_CeilingFanMotors",
      "EMotorMix_NoPumpsPowerToolsFans",
      "EMotorLarge_LessThan1000lbs",
      "Transformer_AluLargeOnly",
      "TransformerCu_AlCu",
      "TransformerCu_SmallPalmSize",
      "TransformerCu_MediumOver200lbs",
      "TransformerCu_Large",
      "Zinc_DieCast"
    ];
    const radiatorProductMaterials = [
      "ACReefer_CleanTalkBaled",
      "ACReefer_CleanUnbaled",
      "ACReefer_DirtyTalkBaled",
      "ACReefer_DirtyUnbaled",
      "Radiator_CleanCar",
      "CuBkg_ACReeferEnd"
    ];
    const materialNames = {
      copper: copperMaterials,
      aluminum: aluminumMaterials,
      brass: brassMaterials,
      lead: leadMaterials,
      stainless: stainlessMaterials,
      eScrap: eScrapMaterials,
      insulatedWire: insulatedWireMaterials,
      miscProduct: miscProductMaterials,
      radiatorProduct: radiatorProductMaterials
    };
    
    // Populate product dropdown based on selected category
    function populateProducts() {
      const categorySelect = document.getElementById('material-category');
      const productSelect = document.getElementById('material-product');
      const category = categorySelect.value;
      productSelect.innerHTML = "";
      if (!category || !materialNames[category]) return;
      materialNames[category].forEach(product => {
        const option = document.createElement('option');
        option.value = product;
        option.textContent = product;
        productSelect.appendChild(option);
      });
    }
    
    // Calculate the futures price using the selected category and product
    function calculateFuturesPrice() {
      const category = document.getElementById('material-category').value;
      const product = document.getElementById('material-product').value;
      let price = null;
      
      if (!category || !product) {
        alert("Please select both a category and a product.");
        return;
      }
      
      if (category === "copper") {
        price = copperPrice(product);
      } else if (category === "aluminum") {
        price = aluminumPrice(product);
      } else if (category === "brass") {
        price = brassPrice(product);
      } else if (category === "lead") {
        price = leadPrice(product);
      } else if (category === "stainless") {
        price = stainlessPrice(product);
      } else if (category === "eScrap") {
        price = eScrapPrice(0.001, 1800, 0.01, 20, 0.05, 0.10);
      } else if (category === "insulatedWire") {
        price = insulatedWirePrice(product);
      } else if (category === "miscProduct") {
        price = miscProductPrice(product);
      } else if (category === "radiatorProduct") {
        price = radiatorProductPrice(product);
      }
      
      const resultDiv = document.getElementById('futures-price-result');
      if (price !== null) {
        resultDiv.innerHTML = `<strong>Calculated Futures Price for ${product}:</strong> $${price.toFixed(3)} per lb`;
      } else {
        resultDiv.innerHTML = `<strong>No pricing formula available for ${product}.</strong>`;
      }
    }
    
    // Logging examples to console
    console.log("Copper Barley Price:", copperPrice("Barley").toFixed(2));
    console.log("AL6061 New Bare Extrusion Price:", aluminumPrice("AL6061_NewBareExtrusion").toFixed(2));
    console.log("Brass Hard Price:", brassPrice("Brass_Hard").toFixed(2));
    console.log("Lead Clean Price:", leadPrice("Lead_Clean").toFixed(2));
    console.log("SS304 Price:", stainlessPrice("SS304").toFixed(2));
    console.log("E-Scrap Board Price:", eScrapPrice(0.001, 1800, 0.01, 20, 0.05, 0.10).toFixed(2));
    console.log("ICW Low Grade Christmas Lights Price:", insulatedWirePrice("ICW_LowGrade_ChristmasLights").toFixed(3));
    console.log("Ballast Electronic Price:", miscProductPrice("Ballast_Electronic").toFixed(3));
    console.log("ACReefer Clean Talk Baled Price:", radiatorProductPrice("ACReefer_CleanTalkBaled").toFixed(3));
    console.log("All Material Names:", materialNames);
  </script>
</body>
</html>
